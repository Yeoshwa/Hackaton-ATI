<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Documentation API - Gestion Participative des DÃ©chets</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        h1, h2, h3 { color: #2c3e50; }
        code, pre { background: #f4f4f4; padding: 2px 4px; border-radius: 3px; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 2em; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background: #eee; }
    </style>
</head>
<body>
    <h1>ğŸ“š Documentation de lâ€™API â€“ Gestion Participative des DÃ©chets</h1>
    <h2>Introduction</h2>
    <p>Cette API permet de signaler, visualiser et commenter des dÃ©pÃ´ts de dÃ©chets dans la ville, tout en gÃ©rant lâ€™authentification, la gamification (points), et lâ€™administration des utilisateurs et signalements.</p>
    <h2>Authentification</h2>
    <ul>
        <li><b>JWT (JSON Web Token)</b> : Toutes les routes protÃ©gÃ©es nÃ©cessitent un token JWT dans lâ€™en-tÃªte <code>Authorization: Bearer &lt;token&gt;</code>.</li>
    </ul>
    <h3>Endpoints</h3>
    <table>
        <tr><th>MÃ©thode</th><th>URL</th><th>Description</th><th>Auth</th></tr>
        <tr><td>POST</td><td>/api/register/</td><td>CrÃ©er un compte utilisateur</td><td>âŒ</td></tr>
        <tr><td>POST</td><td>/api/login/</td><td>Obtenir un token JWT</td><td>âŒ</td></tr>
        <tr><td>POST</td><td>/api/token/refresh/</td><td>RafraÃ®chir un token JWT</td><td>âŒ</td></tr>
        <tr><td>GET</td><td>/api/profile/</td><td>Voir son profil</td><td>âœ”ï¸</td></tr>
        <tr><td>GET</td><td>/api/users/leaderboard/</td><td>Classement des top contributeurs</td><td>âŒ</td></tr>
    </table>
    <h3>Exemple dâ€™inscription</h3>
    <pre><code>POST /api/register/
{
  "username": "alice",
  "email": "alice@example.com",
  "password": "TestPass123"
}</code></pre>
    <h3>Exemple de login</h3>
    <pre><code>POST /api/login/
{
  "username": "alice",
  "password": "TestPass123"
}</code></pre>
    <pre><code>{
  "refresh": "&lt;refresh_token&gt;",
  "access": "&lt;access_token&gt;"
}</code></pre>
    <h2>Signalements (Reports)</h2>
    <table>
        <tr><th>MÃ©thode</th><th>URL</th><th>Description</th><th>Auth</th></tr>
        <tr><td>GET</td><td>/api/reports/</td><td>Liste des signalements (filtrable)</td><td>âŒ</td></tr>
        <tr><td>POST</td><td>/api/reports/</td><td>CrÃ©er un signalement (anonyme ou connectÃ©)</td><td>âŒ/âœ”ï¸</td></tr>
        <tr><td>GET</td><td>/api/reports/{id}/</td><td>DÃ©tail dâ€™un signalement</td><td>âŒ</td></tr>
        <tr><td>PATCH</td><td>/api/reports/{id}/</td><td>Modifier un signalement (auteur/admin)</td><td>âœ”ï¸</td></tr>
        <tr><td>DELETE</td><td>/api/reports/{id}/</td><td>Supprimer un signalement (auteur/admin)</td><td>âœ”ï¸</td></tr>
        <tr><td>GET</td><td>/api/reports/map/</td><td>Liste lÃ©gÃ¨re pour carte</td><td>âŒ</td></tr>
    </table>
    <h3>Exemple de crÃ©ation de signalement</h3>
    <pre><code>POST /api/reports/
Content-Type: multipart/form-data

{
  "latitude": 48.85,
  "longitude": 2.35,
  "photo": &lt;fichier image&gt;,
  "description": "Tas de dÃ©chets prÃ¨s du parc",
  "statut": "signale",
  "gravite": 2
}</code></pre>
    <h2>Commentaires</h2>
    <table>
        <tr><th>MÃ©thode</th><th>URL</th><th>Description</th><th>Auth</th></tr>
        <tr><td>GET</td><td>/api/reports/{report_id}/comments/</td><td>Liste des commentaires dâ€™un signalement</td><td>âŒ</td></tr>
        <tr><td>POST</td><td>/api/reports/{report_id}/comments/</td><td>Ajouter un commentaire</td><td>âœ”ï¸</td></tr>
        <tr><td>DELETE</td><td>/api/comments/{id}/</td><td>Supprimer un commentaire (auteur/admin)</td><td>âœ”ï¸</td></tr>
    </table>
    <h2>Gamification</h2>
    <ul>
        <li>+5 points pour chaque signalement crÃ©Ã©</li>
        <li>+2 points pour chaque commentaire crÃ©Ã©</li>
        <li>Classementâ€¯: <code>/api/users/leaderboard/</code> (top 10 par points)</li>
    </ul>
    <h2>SÃ©curitÃ© & Permissions</h2>
    <ul>
        <li>CrÃ©ation de commentaireâ€¯: Authentification requise</li>
        <li>Modification/Suppression de report/commentâ€¯: Auteur ou admin</li>
        <li>Consultation et crÃ©ation de reportâ€¯: Ouvert Ã  tous (anonyme possible)</li>
        <li>CORSâ€¯: Toutes les origines autorisÃ©es (pour dÃ©veloppement/hackathon)</li>
    </ul>
    <h2>ModÃ¨les de donnÃ©es (schÃ©ma simplifiÃ©)</h2>
    <pre><code>
Utilisateur (User + UserProfile)
- username (string)
- email (string)
- password (hashÃ©)
- statut (stringâ€¯: citoyen/admin)
- points (int)

Signalement (Report)
- user (nullable)
- latitude (float)
- longitude (float)
- photo (image)
- description (texte)
- statut (stringâ€¯: signale/en_cours/nettoye)
- gravite (intâ€¯: 1/2/3)
- created_at (datetime)

Commentaire (Comment)
- user (User)
- report (Report)
- content (texte)
- created_at (datetime)
    </code></pre>
    <h2>Administration</h2>
    <p>Interface Django admin pour gÃ©rer utilisateurs, signalements, commentaires, avec affichage en colonnes de tous les champs importants.</p>
    <h2>Notes</h2>
    <ul>
        <li>Pour la production, restreindre CORS Ã  lâ€™URL de ton frontend.</li>
        <li>Pour toute modification/suppression, le token JWT de lâ€™auteur ou dâ€™un admin est requis.</li>
        <li>Lâ€™upload dâ€™image doit se faire en <code>multipart/form-data</code>.</li>
    </ul>
</body>
</html>